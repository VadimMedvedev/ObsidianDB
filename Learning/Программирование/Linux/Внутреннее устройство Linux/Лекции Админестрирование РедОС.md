
passw: Cisco123Cisco
ssh root@scoch.mooo.com -p 8904   --- общий пк 
ssh student2@scoch.mooo.com -p 8900 -v   --- отдельный


### Boot systemd

Идея виртуализация в том, что виртуалка не знает что она виртуалка, для неё всё эмулируеться.

После загрузки boot выбираеться закгрузочное устройство, среди них могут быть:
1) Жёсткий диск.
2) Флеш устройства.
3) Из сети (PXE) (пк может взаимодействовать с сетью даже без загрузки ОС).

grub2-setpaswword - назначение пароля на загрузчик. Можно также запоролить и bios, но это уже извращение.

Кроме systemd системы инициализации есть ещё система init. Все основные дистрибутивы уже перешли на systemd, но на некоторых хостах она может ещё сохраниться.
Init очень стабильна, она маленькая и уже давно проработана. Systemd содержит весь функционал в себе, а init просто выполняет bash скрипты и каждый скрипт получаеться громоздким. Init файлы содержат переменные, функции и case, а файлы для systemd содержит только переменные.

systemd оперирует разными unit-ами (конфигурационные файлы), их есть много разных типов их, среди них target, service и т.д.
systemctl status - проверяет состояние системы, status:
1) running - работает
2) degraded - значит systemd не смог запусть какую-то зависимость, в failed написано что поломано (сколько юнитов поломано). Командой systemctl | grep failed выведет все поломанные юниты (первая команда показывает все процессы системы). Берём и исправляем ошибку в этом юните.

systemctl это иерархическая команда, после неё идут команды/аргументы
Просто systemctl просто выводит все юниты, каждая строчка это юнит
1) get-default показывает


StateLess vs StateFull - работа с сохранением состояния (systemd) и без сохранения состояния (init).

### Данные на диске

Все диски - блочные устройства. Они хранят блоки данных в связи с геометрией диска, они хранят 1 и 0.

lsblk (list of block devisec) - выводит диски
df -h - свободное пространство показывает

Нет унивирсальных файловых систем, разные приложения могут лучше работать на какой-то определённой фс.
Форматирование - нанесение фс на раздел диска.

Жёсткая ссылка - файл ссылающийся на область памяти, т.е. просто файл, их может быть несколько на одному область данных. Жёсткие ссылки ссылаюься на одни и те же inode. inode во всех разделах разные, поэтому жёсткие ссылки можно делать только в пределе раздела.
Символьная ссылка - файл с путём до другого файла, т.е. она ссылаеться на файл, а не на данные. Может ссылаться на какой угодно файл на каком угодно разделе с какой угодно другой ФС.
команда ln создаёт жёсткую ссылку, с ключём -s символическую. Пример:
ln -s /root/passwd /tmp/

Разбиение дисков бывает несколько типов, самые основные: MBR и GPT.

|                        | MBR       | GPT          |
| ---------------------- | --------- | ------------ |
| место                  | 2Тб<      | хоть сколько |
| область применения     | виртуалки | везде        |
| разделов можно сделать | 4         | 128          |
| поддержиается firmware | bios      | bios и uefi  |
|                        |           |              |
fdisk - используеться для mbr
gdisk - форк fdisk для gpt. Обе команды интерактивные, они будут спрашивать во время создания разбиения.
parted - позволяет работать не интерактивно, поэтому можно заскриптить
gparted - графический parted

fdisk -l - рассказывает все диски которые есть в системе

mkfs.<ФС> - форматирует раздел в нужную ФС. После команды надо указать раздел (например /dev/sda1). Если раздел уже был форматирован, то команда предупредит об этом.


blkid - выводит uuid (уникальный номер раздела, который каждый раз выдаёться новый разделу после форматирования) введённого раздела.

/etc/fstab - flie system table, содержит записи о монтирующихся при запуске системе разделах.
у fstab нет драйрана (т.е. нельзя проверить его на правильность), но можно использовать команды mount -a, swapon -a, если после их исполнения ошибок не возникает, значит всё хорошо и машину можно перезагружать без страха.

du - показывает размер каталога вместе с содержимым!! (просто так каталог - это файл и он по стандарту весит 4 Кб), ncdu - графика в консоли

Большое количесво операций связанных с диском требуют размонтирования. Если с примонтированным каталогам работает какой-то процесс, то мы можем проверить какой процесс использует этот каталог при помощи команд fuser и lsof.

### LVM

LVM - диспетчер логических томов, помогает гибко работать с пространством на дисках.
PV (phisiacl volume) - какие угодно физичиеские устройства
VG (volume grup) - группа из нескольких PV
LV (logical volume) - логический том, которыми мы уже оперируем в системе

pvd, vgs, lvs и pvdisplay, vgdisplay, lvdisplay - команды показывающие значения PV, VG, LV.
pvcreate {/dev/sda1} - создаёт из раздела PV
vgcreate {name VG} {PVs} - создаёт группу из нескольких VG
lvcreate -L {размер} {VG} -n {name LV} - выделяет из VG раздел заданной длины (больше чем есть на VG свободно - нельзя).
vgextend {имя группы} {физический том} - увеличивает размер группы присоединением нофого физического тома.
pvmove {откуда} {куда} - переносит все данные с одного физического тома на другой.
vgreduce {имя группы} {физические тома} - убирает из группы тома.

Дальше LV можно форматировать и монтировать, к нему можно ображаться как /dev/mapper/{VG}-{LV}, где VG группа физических томов на которой был выделен LV.

### LUKS

LUKS - шифрует диски. Это нужно, если диск может быть украден и может быть получен доступ до информации на нём. Он навешивает пароль на весь диск. Это удобно сделать на флешку.

###  Архивация

Есть много разных форматов архивации: gz, zip и т.д.
Архивация и сжатие - разное. При обычной архивации не будет происходить сжатия, но размер может уменьшиться, потому что все файлы будут лежать в притык, а не занимать целое число блоков данных в ФС.
Все архиваторы используют располалелливание процессов, потому что иначе это происходит очень медленно!

### Время

У операционки есть два локальных источника времени и много онлайн. Есть системные часы, они считаються с начала запуска системы (оно относительно от начала запуска системы). Есть же апаратные часы, которые считаються на самой плате, отдельный чип. Пока всё будет работать корректно всё будет хорошо. Но их надо синхронизировать, со временем они расходяться.

Есть протокол NTP (network time protocol), который синхронизириует время в сети.

timedatectl - выводит инфу о времени на пк
timedatectl set-timezone Asia/Krasnoyarsk - выставляет часовой пояс.

### Планировщики задач

##### 1) CRON

Древнейший демон. Каждую минуту просыпаеться и проверяет что сейчас должно выполниться и делает.

crontab -l - показывает все записи
crontab -e - открывает в редакторе планировщик

Cron - старая утилита, так что она очень привередлива к синтаксису. Например **нужно обязательно ставить перевод строки в конце файла!!!** иначе работать не будет.

Временные штампы: * * * * * - минуты, часы, день месяца, месяц, день недели.
##### 2) Anacron

Позволяет запускать задания с точностью до часа.

##### 3) AT

at {время} - открывает планировщик на заданное время, т.е. что он выполнить в это время (в конце используем символ окончания файла ctrl+D).
atq - показывает запланированные задачи.

### Журналирование

RSyslogd - ведёт логи только системы, отедльные приложения логируються сами. Некоторые некрупные подсистемы могут всё же использовать syslog.
В стандарте есть несколько степеней важности логов (их 8, от менее серьёзных до опасных).

rsyslog.d - процесс запускаемый systemd
/etc/rsyslog.conf

в конфиге можно настраивать сортировку логов, фильтрацию
\*.info;...             /var/log/secure

\*.info - все источники с уровнем приоритета выше information
через ; записываеться несколько источников которые будут записываться в один лог файл.
каталог в котором будет это будет использоваться

Одно событие может быть залогированно сразу в нескольких файлах сислогах!! (если оно попадает под несколько фильтраций).

local1-7 - неизвестные источники.

### Audit

 все команды используют системные вызовы, их очень много (300-400). Для того чтобы их отслеживать можно использовать утилиту audit.
 Конфиг audit храниться в директории: /etc/audit/auditd.conf.
 Можно настроить файл в котором будет хранятся логи (log_file), формат файла (log_format) и т.д.
 Можно составлять удобные выборки при помощи команды aureport.
 auditctl -l - показывает все правила введённые пользователями.

### Сеть и сетевые сервисы

