
### Основные понятия

inventory - это файл где перечислены все наши машины и сервера, где они объеденены в группы и т.д. На них указаны ip адреса, порты, и имена пользователей на этом устройстве.
``` yaml
[group_name]
server-1
server-2 ansible_host=10.10.10.2 ansible_port=23 ansible_user=vadim
```


task - минимальная единица которую ансибл может выполнить, конкретная задача, в нём описываються действия для выполнения. Каждый таск должен иметь имя, к нему должны быть прикреплены быть модули (отдельные программы, которые выполняют то или иное действие, не shell команды!! это декларативное описание того что мы хотим, а не императивное пересчисление что нужно сделать!!).
```
- name: Install vim on Ubuntu
  ansible.builtin.apt:
	  name: vim
```
здесь мы устанавлеваем vim при помощи модуля ansible.builtin.apt.

role - законченный набор тасков. В последствии их можно использовать в плейбуках. Таким образом это как функции, которые можно прописать один раз, а потом использовать в разных плейбуках. Каждая роль лежит отдельно в своей директории, где лежат файлы:
1) defaults - переменные по умолчанию
2) tasks - таски
3) templates - шаблоны (?)
4) files - файлы (?)
5) handlers - подвид тасков

playbook - это любой законченный вид действий который мы хотим совершить над хостами или груп хостов.
``` yaml
- hosts: my_group
  roles:
	  - example_role
```
Зачастую отдельные таски не заносятся в плэйбук, а заносятся целые роли.

vars - переменные, они могут задаваться по разному:
1) example_role/defaults - переменные используемые по умолчанию для роли, если для конкретного хоста не указываеться чему должна быть равна переменная.
2) host_vars/server-1.yaml - переменные для конкретного хоста (название файла совпадает с названием хоста в файле inventory)
3) group_vars/group_name.yaml - переменные для конкретныой группы
4) переменные отдельно в плейбуке
5) переменные в записи в файле inventory
Сначала переменная будет искаться у хоста, если она не объявлена в соотвествующем файле, то будет искаться у группы, к которой хост привязан, и только в самом крайнем случае перейдёт к defaults.
Часто удобно занасить все хосты в группу all и задавать для неё переменные, которые будут работать для всех хостов.

### Простейшие модули

Установка пакета:
``` yaml
name_module:
	name: название_пакета
	state: latest
```
по умолчанию state стоит latest, т.е. самая последняя версия. Названия модуля зависит от пакетного менеджера.

Работа с файлами (копирование с локального хоста на сервер и т.д. и т.п.):
``` yaml
name_module:
	src: путь до файла на локальной машине
	dest: путь на удалённой
	owner: владелец
	group: группа
	mode: 755
```

### Файл конфигурации

Файл с конфигами должен храниться в той же директории в которой мы создаём инфроструктуру для конкретного проекта, мы называем его ansible.cfg и указываем слежующие важные строчки конфигурации:
```
[defaults]
inventory = ./inventory # где находиться файл inventory
roles_path = ./roles # где лежат прописанные роли
host_key_checking = false # не будет происходить проверки 
						  # сервера при подключении с клиента
```

### Инвентарь и нужные переменные

Основные переменные которые нужны:
1) ansible_host - ip хоста к которому подключаемся
2) ansible_port - какой порт слушает ssh на этом хосте
3) ansible_user - под кем заходит на хосте
4) ansible_become_pass - пароль для того что бы выполнять команды с sudo

Если shh сервер принимает аутентификацию по поролю (что не безопасно!!!), то достаточно указать пароль пользователя в переменную:
5) ansible_ssh_pass - устаревший и не универсальный вариант
6) ansible_password - тоже самое но новый и рекомендуемый, так как он может использоваться не только для ssh подключения, но и для других похожих утелит.

Если происходит вход по rsa ключу, то надо указать переменную:
7) ansible_ssh_private_key_file - адрес до закрытого ключа
Конечно перед этим надо добавить свой id_rsa.pub с ansible сервера в authorization_keys на хосте.


можно использовать команду для проврки доступа ко всем хостам:
``` bash
ansible all -m ping
```

Хосты можно распределять в группы, для этого перед следующими несколькими хостами, которые мы объединим в одну группу мы ставим \[\] c названием группы. Можно создавать новые группы при помощи объединения старых, это записывается так:
``` yaml
[new_group:children]
group7
group13
...
```
Таким образом новая составленная группы new_group будет состоять из хостов входящих в группы group7 и group13.
Все хосты изначально всегда лежат в группе all.