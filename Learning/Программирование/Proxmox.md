
### Основы

Это форк debian с настроенными инструментами виртуализации. Скачиваеться и устанавливаеться как обычный линукс. При запуске он показывает ip:port сервера где можно в графическом режиме отслеживать нашу систему.

Для виртуализации proxmox использует KVM, а для контейнеризации LXC контейнера (основное отличие от docker контейнеров в том, что у каждого из них свой ip, а не порт).

pve - Proxmox Virtual Environment

Помимо этого, proxmox предоставляет множество инструментов для удобного администрирования сервера. Есть целая графическая оболочка.

### Разбиение диска

В proxmox всё дисковое пространство обозначаеться за hdsize. Одну четвёртую от него занимает rootsize, где соотвественно будет установлена основная система, будут храниться образы ос и контейнеров. swapsize - пространство подкачки (когда всё оперативная память будет занята, будет использоваться место на диске выделенное в swapsize), minfree - зарезервированное свободное пространство, и datasize, где будут распологаться виртуальные жёсткие диски наших контейнеров и виртуальных машин. Итого получаем разделение:
* hdsize
	* rootsize
	* swapsize
	* minfree
	* datasize

### Графическая оболочка

При запуске proxmox сервера он показывает ip:port сервера где можно в графическом режиме отслеживать нашу систему. Вбивая ip:port подключаемся к нему.

Слева есть иерархии нашей системы, которые мы можем выбирать стрелочкой. В server view есть иерархия наших серверов. Datacenter - общая директория, в ней отображаються все proxmox сервера объединённые в кластер.
Выбрав datacenter у нас справа отображаеться полная информация о всей системе (кластере). Основные вкладки:
* Summary - основная информация: сколько работает, сколько не работает серверов, как много RAM и CPU сейчас потребляеться, сколько места на жёстком диске.
* Notes - просто заметки о кластере
* Cluster - здесь создаёться сам кластер 
* Ceph - хранилища на основе ceph, требует отдельную установку и настройку
* Options - основные настройки
* Storage - все диски (логические, т.е. их разделы и т.д.) которые используються в системе.
* Backup - настраиваються бэкапы
* Replication - дублирование конфигурации с одного proxmox сервера, на другой.
* Permissions - создание разграничений для пользователей и всего подряд
* HA - настройка доступа из одних нод к другим.
* SDN - создание виртуальных сетей между нашими машинами и контейнерами
* ACME - настройка автоматического создания сертификатов
* Firewall - настройка firewall ами между машинами
* Metric Server - настройка хранилища метрик
* Resource Mappings - добавление PCI (видеокарта, аудиокарта, wifi модуль и т.д.) устройств к нашим машинам
* Notifications - настройка уведомлений на email и не только

На каждой ноде (proxmox сервере) у нас также есть свои вкладки:
* Summary - также инфа и метрики, но только по этой ноде
* Notes - заметки по этой ноде
* Shell - терминал proxmox сервера, для ручной работы на сервере
* System - контроль над процессами, удаление и запуск их
	* Network - работа с сетевыми интерфейсами
	* Certificates - работа с сертификатами ssl
	* DNS - указание где DNS сервер
	* Hosts - как на линуксе /etc/hosts - ручное внесение dns записей
	* Options - mac адресс, задержка при запуске
	* Time - настройка времени
	* Syslog - записи из syslog
* Updates - заупск апгрейдов/апдейтов
	* Repositories - откуда беруться апдейты/апгрейды, указание репозиториев
*  Firewall - настройка firewall'а
* Disks - диски на ноде и их разбиения lvm
* Ceph - для этой ноды ceph
* Replication - настройки репликации этой ноды
* Task History - история действий

Спускаясь дальше по иерархии, у каждой вирутальной машины мы видем обекты local и local-lvm - это диски, на первом будут храниться образы, а на втором жёсткие диски виртуалок.

### Создание виртальной машины

Во вкладке ISO Images (local на ноде proxmox) - можно добавить образы ОС: либо с компа (Upload), либо по URL (Download from URL) (если последний вариант не работает, стоит проверить ip DNS серверов).

После загрузки нескольких образов можно приступать к созданию виртуальных машин, это делаеться кнопкой Create VM, мы выбираем ноду на которой сделаем виртуалку, её id (его можно будет использовать в терминале для ручной работы с виртуалкой в KVM), название виртуалки.
Галачка start at boot будет запускать эту VM сразу при каждом запуске proxmox сервера.
Тэги (tags) позволяют удобно разбивать машины на группы.
Во вкладке OS задаёться образ с которого будет установлен ОС. Можно выбрать диск с которого мы берём образ (он может принадлежать другой ноде в кластере).
На вкладке System, при стандартной настройке, лучше оставить всё стандартным. Можно поставить галочку Qemu agent, чтобы потом можно было работать и с виртуальной машиной через графическую оболочку proxmox. BIOS выбираеться между стандартным BIOS и UEFI.
В следующей вкладке можно добавлять диски, выбирать их размер и хранилище откуда выделять для них место (можно использовать хранилища других серверов).
Вкладки CPU и Memory соответсвенно отвечают за выделяемую мощность процессора и оперативной памяти.
Network для начала можно оставить стандартным.

### Клонирование и шаблоны

Чтобы каждый раз не устанавливает ос на каждой машине можно клонировать уже созданные, это очень просто: нажимаем ПКМ на нужную машину и нажимаем на клонирование, создастся новая машина с таким же содержимым и уже установленной ОС.
Также любую машину(контейнер) мы можем превратить в шаблон (при этом машина пропадёт). Из этого шаблона можно будет создавать подобные машины, а также копировать его и изменять.
При копировании шаблона (т.е. создании VM из шаблона) есть опция режима (mode):
1) Linked clone - изначальный шаблон будет базовым и его нельзя будет удалить, в новой машине будут записываться вещи, которые отличаються от базового шаблона. Это уменьшает размеры склонированных машин. Но машины будут полностью зависеть от базового шаблона.
2) Full clone - полная копия изначального шаблона, после этого изначальный шаблон можно удалить. При таком копировании новая машина будет весить столько же как и изначальный шаблон.
Чаще всего используют Full clone, хотя есть экзотические ситуации, когда стоит использовать linked clone.

### Настройка сети

По стандарту, создаёться виртуальный мост vmbr0 (устройство соединяющая нескольк LAN в одну большую сеть, помогающая безпрепятсвенно передовать пакеты между сетями). К этому мосту и подключаться все наши виртуальные машины.